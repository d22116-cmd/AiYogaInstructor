<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Asana Guru | Intelligent Yoga Posture Analysis</title>
    
    <!-- Apple-inspired Typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- TensorFlow.js for Pose Detection -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection@2.1.0/dist/pose-detection.min.js"></script>
    
    <style>
        /* ================================================
           AI ASANA GURU - APPLE-INSPIRED DESIGN SYSTEM
           Clean. Minimal. Premium. Intelligent.
        ================================================ */
        
        :root {
            /* Apple Color Palette */
            --white: #ffffff;
            --gray-50: #fafafa;
            --gray-100: #f5f5f7;
            --gray-200: #e8e8ed;
            --gray-300: #d2d2d7;
            --gray-400: #86868b;
            --gray-500: #6e6e73;
            --gray-600: #515154;
            --gray-900: #1d1d1f;
            --black: #000000;
            
            /* Accent Colors */
            --blue: #0071e3;
            --blue-hover: #0077ed;
            --green: #34c759;
            --orange: #ff9500;
            --red: #ff3b30;
            --purple: #af52de;
            --teal: #5ac8fa;
            
            /* Gradients */
            --gradient-hero: linear-gradient(180deg, #f5f5f7 0%, #ffffff 100%);
            --gradient-card: linear-gradient(145deg, #ffffff 0%, #f5f5f7 100%);
            --gradient-accent: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            
            /* Shadows */
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 12px 40px rgba(0,0,0,0.12);
            --shadow-xl: 0 24px 80px rgba(0,0,0,0.14);
            
            /* Typography */
            --font-display: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-body: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            
            /* Spacing */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;
            --space-3xl: 64px;
            --space-4xl: 96px;
            
            /* Border Radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-2xl: 32px;
            --radius-full: 9999px;
            
            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 400ms cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Reset & Base */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html {
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body {
            font-family: var(--font-body);
            font-size: 17px;
            line-height: 1.5;
            color: var(--gray-900);
            background: var(--white);
            overflow-x: hidden;
        }
        
        /* ================================================
           NAVIGATION - Minimal Apple Style
        ================================================ */
        
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 48px;
            background: rgba(255, 255, 255, 0.72);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .nav-content {
            width: 100%;
            max-width: 1024px;
            padding: 0 var(--space-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .nav-logo {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-family: var(--font-display);
            font-weight: 600;
            font-size: 18px;
            color: var(--gray-900);
            text-decoration: none;
        }
        
        .nav-logo svg {
            width: 28px;
            height: 28px;
        }
        
        .nav-links {
            display: flex;
            gap: var(--space-xl);
            list-style: none;
        }
        
        .nav-links a {
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-600);
            text-decoration: none;
            transition: color var(--transition-fast);
        }
        
        .nav-links a:hover {
            color: var(--gray-900);
        }
        
        .nav-links a.active {
            color: var(--blue);
        }
        
        /* ================================================
           MAIN LAYOUT
        ================================================ */
        
        .main {
            padding-top: 48px;
            min-height: 100vh;
        }
        
        /* ================================================
           HERO SECTION
        ================================================ */
        
        .hero {
            background: var(--gradient-hero);
            padding: var(--space-4xl) var(--space-lg);
            text-align: center;
        }
        
        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-xs) var(--space-md);
            background: var(--white);
            border-radius: var(--radius-full);
            box-shadow: var(--shadow-sm);
            font-size: 12px;
            font-weight: 600;
            color: var(--blue);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--space-lg);
            animation: fadeInUp 0.6s ease-out;
        }
        
        .hero-badge::before {
            content: '';
            width: 8px;
            height: 8px;
            background: var(--green);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }
        
        .hero-title {
            font-family: var(--font-display);
            font-size: clamp(48px, 8vw, 80px);
            font-weight: 700;
            line-height: 1.05;
            letter-spacing: -0.03em;
            color: var(--gray-900);
            margin-bottom: var(--space-lg);
            animation: fadeInUp 0.6s ease-out 0.1s both;
        }
        
        .hero-title span {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .hero-subtitle {
            font-size: 21px;
            font-weight: 400;
            color: var(--gray-500);
            max-width: 600px;
            margin: 0 auto var(--space-xl);
            animation: fadeInUp 0.6s ease-out 0.2s both;
        }
        
        .hero-cta {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
            animation: fadeInUp 0.6s ease-out 0.3s both;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ================================================
           BUTTONS
        ================================================ */
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            padding: 12px 24px;
            font-family: var(--font-body);
            font-size: 17px;
            font-weight: 500;
            border-radius: var(--radius-full);
            border: none;
            cursor: pointer;
            transition: all var(--transition-base);
            text-decoration: none;
        }
        
        .btn-primary {
            background: var(--blue);
            color: var(--white);
        }
        
        .btn-primary:hover {
            background: var(--blue-hover);
            transform: scale(1.02);
        }
        
        .btn-secondary {
            background: var(--white);
            color: var(--blue);
            border: 1px solid var(--gray-200);
        }
        
        .btn-secondary:hover {
            background: var(--gray-50);
            border-color: var(--gray-300);
        }
        
        .btn-large {
            padding: 16px 32px;
            font-size: 19px;
        }
        
        .btn-icon {
            width: 48px;
            height: 48px;
            padding: 0;
            border-radius: 50%;
        }
        
        /* ================================================
           APP CONTAINER
        ================================================ */
        
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-2xl) var(--space-lg);
        }
        
        .app-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: var(--space-xl);
            min-height: calc(100vh - 200px);
        }
        
        @media (max-width: 1024px) {
            .app-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* ================================================
           VIDEO/CAMERA SECTION
        ================================================ */
        
        .camera-section {
            position: relative;
            background: var(--gray-900);
            border-radius: var(--radius-2xl);
            overflow: hidden;
            aspect-ratio: 16/10;
            box-shadow: var(--shadow-xl);
        }
        
        .camera-container {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        #videoElement {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }
        
        #canvasOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: scaleX(-1);
            pointer-events: none;
        }
        
        .camera-placeholder {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: var(--space-lg);
            color: var(--white);
            text-align: center;
            padding: var(--space-xl);
        }
        
        .camera-placeholder.hidden {
            display: none;
        }
        
        .camera-placeholder svg {
            width: 80px;
            height: 80px;
            opacity: 0.5;
        }
        
        .camera-placeholder h3 {
            font-family: var(--font-display);
            font-size: 24px;
            font-weight: 600;
        }
        
        .camera-placeholder p {
            font-size: 15px;
            color: var(--gray-400);
            max-width: 300px;
        }
        
        /* Camera Controls Overlay */
        .camera-controls {
            position: absolute;
            bottom: var(--space-lg);
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: var(--space-md);
            padding: var(--space-sm);
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-full);
        }
        
        .camera-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.15);
            color: var(--white);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .camera-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.05);
        }
        
        .camera-btn.active {
            background: var(--blue);
        }
        
        .camera-btn.record {
            background: var(--red);
        }
        
        .camera-btn svg {
            width: 24px;
            height: 24px;
        }
        
        /* Live Stats Overlay */
        .live-stats {
            position: absolute;
            top: var(--space-lg);
            left: var(--space-lg);
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }
        
        .stat-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-full);
            font-size: 13px;
            font-weight: 600;
            color: var(--white);
        }
        
        .stat-badge .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .stat-badge .dot.green { background: var(--green); }
        .stat-badge .dot.orange { background: var(--orange); }
        .stat-badge .dot.red { background: var(--red); }
        
        /* Score Display */
        .score-display {
            position: absolute;
            top: var(--space-lg);
            right: var(--space-lg);
            text-align: right;
        }
        
        .score-ring {
            position: relative;
            width: 100px;
            height: 100px;
        }
        
        .score-ring svg {
            transform: rotate(-90deg);
        }
        
        .score-ring circle {
            fill: none;
            stroke-width: 8;
        }
        
        .score-ring .bg {
            stroke: rgba(255, 255, 255, 0.1);
        }
        
        .score-ring .progress {
            stroke: var(--green);
            stroke-linecap: round;
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 0.5s ease-out, stroke 0.3s ease;
        }
        
        .score-value {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--white);
        }
        
        .score-value .number {
            font-family: var(--font-display);
            font-size: 32px;
            font-weight: 700;
            line-height: 1;
        }
        
        .score-value .label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.7;
        }
        
        /* ================================================
           SIDEBAR PANEL
        ================================================ */
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
        }
        
        /* Card Component */
        .card {
            background: var(--white);
            border-radius: var(--radius-xl);
            border: 1px solid var(--gray-200);
            overflow: hidden;
            transition: all var(--transition-base);
        }
        
        .card:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--gray-300);
        }
        
        .card-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .card-title {
            font-family: var(--font-display);
            font-size: 17px;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .card-badge {
            padding: var(--space-xs) var(--space-sm);
            background: var(--gray-100);
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-500);
        }
        
        .card-content {
            padding: var(--space-lg);
        }
        
        /* ================================================
           ASANA SELECTOR
        ================================================ */
        
        .asana-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-sm);
        }
        
        .asana-item {
            position: relative;
            padding: var(--space-md);
            background: var(--gray-50);
            border-radius: var(--radius-md);
            border: 2px solid transparent;
            cursor: pointer;
            transition: all var(--transition-fast);
            text-align: center;
        }
        
        .asana-item:hover {
            background: var(--white);
            border-color: var(--gray-200);
            transform: translateY(-2px);
        }
        
        .asana-item.selected {
            background: rgba(0, 113, 227, 0.08);
            border-color: var(--blue);
        }
        
        .asana-item .icon {
            font-size: 32px;
            margin-bottom: var(--space-xs);
        }
        
        .asana-item .name {
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 2px;
        }
        
        .asana-item .sanskrit {
            font-size: 11px;
            color: var(--gray-500);
            font-style: italic;
        }
        
        .asana-item .difficulty {
            position: absolute;
            top: var(--space-sm);
            right: var(--space-sm);
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .asana-item .difficulty.easy { background: var(--green); }
        .asana-item .difficulty.medium { background: var(--orange); }
        .asana-item .difficulty.hard { background: var(--red); }
        
        /* ================================================
           ALIGNMENT FEEDBACK
        ================================================ */
        
        .alignment-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }
        
        .alignment-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            background: var(--gray-50);
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
        }
        
        .alignment-item.correct {
            background: rgba(52, 199, 89, 0.1);
        }
        
        .alignment-item.warning {
            background: rgba(255, 149, 0, 0.1);
        }
        
        .alignment-item.error {
            background: rgba(255, 59, 48, 0.1);
        }
        
        .alignment-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .alignment-item.correct .alignment-icon {
            background: var(--green);
            color: var(--white);
        }
        
        .alignment-item.warning .alignment-icon {
            background: var(--orange);
            color: var(--white);
        }
        
        .alignment-item.error .alignment-icon {
            background: var(--red);
            color: var(--white);
        }
        
        .alignment-info {
            flex: 1;
            min-width: 0;
        }
        
        .alignment-info .part {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .alignment-info .feedback {
            font-size: 12px;
            color: var(--gray-500);
        }
        
        .alignment-angle {
            font-family: var(--font-display);
            font-size: 18px;
            font-weight: 700;
            color: var(--gray-900);
        }
        
        /* ================================================
           SESSION STATS
        ================================================ */
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
        }
        
        .stat-card {
            padding: var(--space-md);
            background: var(--gray-50);
            border-radius: var(--radius-md);
            text-align: center;
        }
        
        .stat-card .value {
            font-family: var(--font-display);
            font-size: 28px;
            font-weight: 700;
            color: var(--gray-900);
            line-height: 1;
            margin-bottom: var(--space-xs);
        }
        
        .stat-card .label {
            font-size: 12px;
            color: var(--gray-500);
            font-weight: 500;
        }
        
        /* ================================================
           ASANA LIBRARY (Expanded View)
        ================================================ */
        
        .library-section {
            padding: var(--space-3xl) var(--space-lg);
            background: var(--gray-50);
        }
        
        .section-header {
            max-width: 1200px;
            margin: 0 auto var(--space-2xl);
            text-align: center;
        }
        
        .section-header h2 {
            font-family: var(--font-display);
            font-size: 48px;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-md);
        }
        
        .section-header p {
            font-size: 19px;
            color: var(--gray-500);
            max-width: 600px;
            margin: 0 auto;
        }
        
        .library-filters {
            display: flex;
            justify-content: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-xl);
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: var(--space-sm) var(--space-lg);
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-full);
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-600);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .filter-btn:hover {
            border-color: var(--gray-300);
            color: var(--gray-900);
        }
        
        .filter-btn.active {
            background: var(--blue);
            border-color: var(--blue);
            color: var(--white);
        }
        
        .library-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--space-lg);
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .library-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            overflow: hidden;
            border: 1px solid var(--gray-200);
            cursor: pointer;
            transition: all var(--transition-base);
        }
        
        .library-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        .library-card-image {
            aspect-ratio: 4/3;
            background: linear-gradient(135deg, var(--gray-100) 0%, var(--gray-200) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 72px;
        }
        
        .library-card-content {
            padding: var(--space-lg);
        }
        
        .library-card-content h3 {
            font-family: var(--font-display);
            font-size: 19px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-xs);
        }
        
        .library-card-content .sanskrit {
            font-size: 14px;
            color: var(--gray-500);
            font-style: italic;
            margin-bottom: var(--space-md);
        }
        
        .library-card-meta {
            display: flex;
            gap: var(--space-sm);
        }
        
        .meta-tag {
            padding: var(--space-xs) var(--space-sm);
            background: var(--gray-100);
            border-radius: var(--radius-sm);
            font-size: 11px;
            font-weight: 600;
            color: var(--gray-600);
        }
        
        .meta-tag.beginner { background: rgba(52, 199, 89, 0.15); color: #1d7a3a; }
        .meta-tag.intermediate { background: rgba(255, 149, 0, 0.15); color: #9a5c00; }
        .meta-tag.advanced { background: rgba(255, 59, 48, 0.15); color: #c41e16; }
        
        /* ================================================
           FOOTER
        ================================================ */
        
        .footer {
            padding: var(--space-3xl) var(--space-lg);
            background: var(--gray-900);
            color: var(--white);
            text-align: center;
        }
        
        .footer-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            font-family: var(--font-display);
            font-size: 24px;
            font-weight: 600;
            margin-bottom: var(--space-lg);
        }
        
        .footer p {
            color: var(--gray-400);
            font-size: 14px;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: var(--space-xl);
            margin-top: var(--space-lg);
        }
        
        .footer-links a {
            color: var(--gray-400);
            font-size: 14px;
            text-decoration: none;
            transition: color var(--transition-fast);
        }
        
        .footer-links a:hover {
            color: var(--white);
        }
        
        /* ================================================
           LOADING STATE
        ================================================ */
        
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: var(--space-lg);
            z-index: 2000;
            opacity: 1;
            transition: opacity 0.5s ease;
        }
        
        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--gray-200);
            border-top-color: var(--blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-family: var(--font-display);
            font-size: 17px;
            font-weight: 500;
            color: var(--gray-600);
        }
        
        /* ================================================
           RESPONSIVE
        ================================================ */
        
        @media (max-width: 768px) {
            .hero-title {
                font-size: 36px;
            }
            
            .hero-subtitle {
                font-size: 17px;
            }
            
            .hero-cta {
                flex-direction: column;
            }
            
            .nav-links {
                display: none;
            }
            
            .asana-grid {
                grid-template-columns: 1fr;
            }
            
            .camera-section {
                aspect-ratio: 4/3;
            }
        }
        
        /* ================================================
           VOICE GUIDANCE TOGGLE
        ================================================ */
        
        .voice-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-md);
            background: var(--gray-50);
            border-radius: var(--radius-md);
        }
        
        .voice-toggle .label {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-900);
        }
        
        .toggle-switch {
            position: relative;
            width: 51px;
            height: 31px;
            background: var(--gray-300);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: background var(--transition-fast);
        }
        
        .toggle-switch.active {
            background: var(--green);
        }
        
        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 27px;
            height: 27px;
            background: var(--white);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: transform var(--transition-fast);
        }
        
        .toggle-switch.active::after {
            transform: translateX(20px);
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading AI Pose Detection...</div>
    </div>

    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-content">
            <a href="#" class="nav-logo">
                <svg viewBox="0 0 32 32" fill="none">
                    <circle cx="16" cy="16" r="14" stroke="currentColor" stroke-width="2"/>
                    <path d="M16 8v8l6 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <circle cx="16" cy="16" r="3" fill="currentColor"/>
                </svg>
                AI Asana Guru
            </a>
            <ul class="nav-links">
                <li><a href="#practice" class="active">Practice</a></li>
                <li><a href="#library">Asana Library</a></li>
                <li><a href="#progress">My Progress</a></li>
                <li><a href="#settings">Settings</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main">
        <!-- Hero Section -->
        <section class="hero" id="hero">
            <div class="hero-badge">
                <span>AI-Powered</span>
            </div>
            <h1 class="hero-title">
                Perfect Your <span>Asana</span>
            </h1>
            <p class="hero-subtitle">
                Real-time posture analysis using advanced computer vision. Get instant feedback on alignment, breathing, and form.
            </p>
            <div class="hero-cta">
                <button class="btn btn-primary btn-large" onclick="startPractice()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="5 3 19 12 5 21 5 3"/>
                    </svg>
                    Start Practice
                </button>
                <a href="#library" class="btn btn-secondary btn-large">
                    Browse Asanas
                </a>
            </div>
        </section>

        <!-- Practice App Section -->
        <section class="app-container" id="practice">
            <div class="app-grid">
                <!-- Camera/Video Section -->
                <div class="camera-section">
                    <div class="camera-container">
                        <video id="videoElement" autoplay playsinline></video>
                        <canvas id="canvasOverlay"></canvas>
                        
                        <!-- Placeholder when camera is off -->
                        <div class="camera-placeholder" id="cameraPlaceholder">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                                <circle cx="12" cy="13" r="4"/>
                            </svg>
                            <h3>Camera Required</h3>
                            <p>Allow camera access to begin AI-powered pose analysis</p>
                            <button class="btn btn-primary" onclick="enableCamera()">
                                Enable Camera
                            </button>
                        </div>
                        
                        <!-- Live Stats -->
                        <div class="live-stats" id="liveStats" style="display: none;">
                            <div class="stat-badge">
                                <span class="dot green"></span>
                                <span id="poseStatus">Detecting...</span>
                            </div>
                            <div class="stat-badge">
                                <span>üéØ</span>
                                <span id="currentAsana">Tadasana</span>
                            </div>
                        </div>
                        
                        <!-- Score Display -->
                        <div class="score-display" id="scoreDisplay" style="display: none;">
                            <div class="score-ring">
                                <svg width="100" height="100" viewBox="0 0 100 100">
                                    <circle class="bg" cx="50" cy="50" r="45"/>
                                    <circle class="progress" id="scoreProgress" cx="50" cy="50" r="45"/>
                                </svg>
                                <div class="score-value">
                                    <span class="number" id="scoreNumber">0</span>
                                    <span class="label">Score</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Camera Controls -->
                        <div class="camera-controls" id="cameraControls" style="display: none;">
                            <button class="camera-btn" onclick="toggleCamera()" title="Toggle Camera">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                                    <circle cx="12" cy="13" r="4"/>
                                </svg>
                            </button>
                            <button class="camera-btn" id="recordBtn" onclick="toggleRecording()" title="Record Session">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <circle cx="12" cy="12" r="8"/>
                                </svg>
                            </button>
                            <button class="camera-btn" onclick="captureSnapshot()" title="Capture Snapshot">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                            </button>
                            <button class="camera-btn" onclick="toggleFullscreen()" title="Fullscreen">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="15 3 21 3 21 9"/>
                                    <polyline points="9 21 3 21 3 15"/>
                                    <line x1="21" y1="3" x2="14" y2="10"/>
                                    <line x1="3" y1="21" x2="10" y2="14"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Sidebar -->
                <div class="sidebar">
                    <!-- Asana Selection Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Select Asana</h3>
                            <span class="card-badge" id="asanaCount">40+ Poses</span>
                        </div>
                        <div class="card-content">
                            <div class="asana-grid" id="asanaGrid">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Alignment Feedback Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Alignment Feedback</h3>
                            <span class="card-badge" id="feedbackStatus">Real-time</span>
                        </div>
                        <div class="card-content">
                            <div class="alignment-list" id="alignmentList">
                                <div class="alignment-item">
                                    <div class="alignment-icon">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"/>
                                            <line x1="12" y1="8" x2="12" y2="16"/>
                                            <line x1="8" y1="12" x2="16" y2="12"/>
                                        </svg>
                                    </div>
                                    <div class="alignment-info">
                                        <div class="part">Waiting...</div>
                                        <div class="feedback">Select an asana and start practice</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Session Stats Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Session Stats</h3>
                        </div>
                        <div class="card-content">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="value" id="sessionTime">00:00</div>
                                    <div class="label">Duration</div>
                                </div>
                                <div class="stat-card">
                                    <div class="value" id="posesCompleted">0</div>
                                    <div class="label">Poses Done</div>
                                </div>
                                <div class="stat-card">
                                    <div class="value" id="avgScore">--</div>
                                    <div class="label">Avg Score</div>
                                </div>
                                <div class="stat-card">
                                    <div class="value" id="calories">0</div>
                                    <div class="label">Calories</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Voice Guidance -->
                    <div class="card">
                        <div class="card-content">
                            <div class="voice-toggle">
                                <div class="label">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                                        <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
                                    </svg>
                                    Voice Guidance
                                </div>
                                <div class="toggle-switch" id="voiceToggle" onclick="toggleVoice()"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Asana Library Section -->
        <section class="library-section" id="library">
            <div class="section-header">
                <h2>Asana Library</h2>
                <p>Explore our comprehensive collection of yoga poses with detailed instructions and AI-powered guidance.</p>
            </div>
            
            <div class="library-filters">
                <button class="filter-btn active" data-filter="all">All Poses</button>
                <button class="filter-btn" data-filter="standing">Standing</button>
                <button class="filter-btn" data-filter="seated">Seated</button>
                <button class="filter-btn" data-filter="balancing">Balancing</button>
                <button class="filter-btn" data-filter="backbends">Backbends</button>
                <button class="filter-btn" data-filter="forward-folds">Forward Folds</button>
                <button class="filter-btn" data-filter="inversions">Inversions</button>
            </div>
            
            <div class="library-grid" id="libraryGrid">
                <!-- Populated by JavaScript -->
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-logo">
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                <circle cx="16" cy="16" r="14" stroke="currentColor" stroke-width="2"/>
                <path d="M16 8v8l6 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <circle cx="16" cy="16" r="3" fill="currentColor"/>
            </svg>
            AI Asana Guru
        </div>
        <p>Part of YogaXBiofeedback Platform</p>
        <p>Bridging 5,000-year-old Yogic wisdom with cutting-edge AI technology.</p>
        <div class="footer-links">
            <a href="#">Privacy Policy</a>
            <a href="#">Terms of Service</a>
            <a href="#">Contact</a>
            <a href="#">Research</a>
        </div>
    </footer>

    <script>
        // ================================================
        // AI ASANA GURU - MAIN APPLICATION
        // VLM-Based Posture Analysis with TensorFlow.js
        // ================================================
        
        // Asana Database with detailed information
        const asanaDatabase = [
            // Standing Poses
            { id: 'tadasana', name: 'Mountain Pose', sanskrit: 'TƒÅ·∏çƒÅsana', category: 'standing', difficulty: 'easy', icon: 'üßò', 
              keypoints: ['feet_together', 'spine_straight', 'shoulders_relaxed', 'arms_sides'],
              instructions: 'Stand with feet together, spine erect, arms by sides. Ground through all four corners of feet.' },
            { id: 'vrikshasana', name: 'Tree Pose', sanskrit: 'V·πõk·π£ƒÅsana', category: 'balancing', difficulty: 'easy', icon: 'üå≥',
              keypoints: ['standing_leg_straight', 'raised_foot_on_thigh', 'hips_level', 'arms_overhead'],
              instructions: 'Stand on one leg, place other foot on inner thigh. Bring palms together overhead.' },
            { id: 'virabhadrasana1', name: 'Warrior I', sanskrit: 'Vƒ´rabhadrƒÅsana I', category: 'standing', difficulty: 'medium', icon: '‚öîÔ∏è',
              keypoints: ['front_knee_90', 'back_leg_straight', 'hips_forward', 'arms_up'],
              instructions: 'Lunge with front knee at 90¬∞, back leg straight. Arms reach overhead, hips face forward.' },
            { id: 'virabhadrasana2', name: 'Warrior II', sanskrit: 'Vƒ´rabhadrƒÅsana II', category: 'standing', difficulty: 'medium', icon: 'üó°Ô∏è',
              keypoints: ['front_knee_90', 'back_leg_straight', 'arms_parallel', 'gaze_forward'],
              instructions: 'Lunge with arms extended parallel to floor, gaze over front hand.' },
            { id: 'virabhadrasana3', name: 'Warrior III', sanskrit: 'Vƒ´rabhadrƒÅsana III', category: 'balancing', difficulty: 'hard', icon: '‚úàÔ∏è',
              keypoints: ['standing_leg_straight', 'torso_parallel', 'back_leg_lifted', 'arms_forward'],
              instructions: 'Balance on one leg, torso and lifted leg parallel to floor.' },
            { id: 'trikonasana', name: 'Triangle Pose', sanskrit: 'Triko·πáƒÅsana', category: 'standing', difficulty: 'medium', icon: 'üìê',
              keypoints: ['legs_wide', 'torso_side_bend', 'arms_line', 'gaze_up'],
              instructions: 'Wide stance, reach to side, stack arms vertically, gaze up.' },
            { id: 'parsvakonasana', name: 'Side Angle', sanskrit: 'PƒÅr≈õvako·πáƒÅsana', category: 'standing', difficulty: 'medium', icon: 'üìä',
              keypoints: ['front_knee_90', 'side_stretch', 'arm_overhead', 'back_leg_straight'],
              instructions: 'Lunge, place forearm on thigh, reach top arm over ear.' },
            { id: 'utkatasana', name: 'Chair Pose', sanskrit: 'Utka·π≠ƒÅsana', category: 'standing', difficulty: 'medium', icon: 'ü™ë',
              keypoints: ['knees_bent', 'weight_heels', 'spine_long', 'arms_up'],
              instructions: 'Bend knees as if sitting, arms reach overhead, weight in heels.' },
            
            // Seated Poses
            { id: 'padmasana', name: 'Lotus Pose', sanskrit: 'PadmƒÅsana', category: 'seated', difficulty: 'hard', icon: 'ü™∑',
              keypoints: ['crossed_legs', 'feet_on_thighs', 'spine_straight', 'hands_mudra'],
              instructions: 'Cross legs with feet on opposite thighs, spine erect.' },
            { id: 'sukhasana', name: 'Easy Pose', sanskrit: 'SukhƒÅsana', category: 'seated', difficulty: 'easy', icon: 'üßò‚Äç‚ôÄÔ∏è',
              keypoints: ['crossed_legs', 'spine_straight', 'shoulders_relaxed', 'hands_knees'],
              instructions: 'Simple cross-legged position with spine tall.' },
            { id: 'dandasana', name: 'Staff Pose', sanskrit: 'Da·πá·∏çƒÅsana', category: 'seated', difficulty: 'easy', icon: 'üìè',
              keypoints: ['legs_extended', 'spine_90', 'hands_by_hips', 'feet_flexed'],
              instructions: 'Sit with legs extended, spine perpendicular to floor.' },
            { id: 'paschimottanasana', name: 'Seated Forward Bend', sanskrit: 'Pa≈õcimottƒÅnƒÅsana', category: 'forward-folds', difficulty: 'medium', icon: 'üîª',
              keypoints: ['legs_straight', 'torso_folded', 'reach_feet', 'spine_long'],
              instructions: 'Fold forward over extended legs, reaching for feet.' },
            { id: 'janusirsasana', name: 'Head to Knee', sanskrit: 'JƒÅnu≈õƒ´r·π£ƒÅsana', category: 'forward-folds', difficulty: 'medium', icon: 'ü¶µ',
              keypoints: ['one_leg_bent', 'fold_over_straight', 'reach_foot', 'head_toward_knee'],
              instructions: 'One leg bent, fold over extended leg toward foot.' },
            { id: 'baddhakonasana', name: 'Butterfly Pose', sanskrit: 'Baddhako·πáƒÅsana', category: 'seated', difficulty: 'easy', icon: 'ü¶ã',
              keypoints: ['soles_together', 'knees_open', 'spine_tall', 'hold_feet'],
              instructions: 'Bring soles of feet together, let knees fall open.' },
            
            // Backbends
            { id: 'bhujangasana', name: 'Cobra Pose', sanskrit: 'Bhuja·πÖgƒÅsana', category: 'backbends', difficulty: 'easy', icon: 'üêç',
              keypoints: ['hands_under_shoulders', 'chest_lifted', 'shoulders_back', 'legs_grounded'],
              instructions: 'Lying prone, press hands to lift chest, shoulders back.' },
            { id: 'urdhvamukhasvanasana', name: 'Upward Dog', sanskrit: '≈™rdhva Mukha ≈övƒÅnƒÅsana', category: 'backbends', difficulty: 'medium', icon: 'üêï',
              keypoints: ['arms_straight', 'chest_open', 'thighs_lifted', 'tops_feet_down'],
              instructions: 'Press through hands, lift chest and thighs off floor.' },
            { id: 'setu_bandhasana', name: 'Bridge Pose', sanskrit: 'Setu BandhƒÅsana', category: 'backbends', difficulty: 'easy', icon: 'üåâ',
              keypoints: ['feet_hip_width', 'hips_lifted', 'shoulders_grounded', 'chin_neutral'],
              instructions: 'Lying on back, press feet to lift hips toward ceiling.' },
            { id: 'ustrasana', name: 'Camel Pose', sanskrit: 'U·π£·π≠rƒÅsana', category: 'backbends', difficulty: 'medium', icon: 'üê™',
              keypoints: ['kneeling', 'hips_forward', 'chest_open', 'hands_heels'],
              instructions: 'Kneel, press hips forward, reach back for heels.' },
            { id: 'dhanurasana', name: 'Bow Pose', sanskrit: 'DhanurƒÅsana', category: 'backbends', difficulty: 'hard', icon: 'üèπ',
              keypoints: ['hold_ankles', 'kick_back', 'chest_lifts', 'rock_gently'],
              instructions: 'Lying prone, grab ankles, kick to lift chest and thighs.' },
            
            // Forward Folds
            { id: 'uttanasana', name: 'Standing Forward Bend', sanskrit: 'UttƒÅnƒÅsana', category: 'forward-folds', difficulty: 'easy', icon: 'üôá',
              keypoints: ['legs_straight', 'fold_from_hips', 'head_hangs', 'hands_to_floor'],
              instructions: 'Fold forward from hips, let head hang heavy.' },
            { id: 'prasarita', name: 'Wide-Leg Forward Fold', sanskrit: 'PrasƒÅrita PƒÅdottƒÅnƒÅsana', category: 'forward-folds', difficulty: 'medium', icon: 'ü¶∂',
              keypoints: ['legs_wide', 'fold_center', 'hands_floor', 'crown_down'],
              instructions: 'Wide stance, fold forward bringing crown toward floor.' },
            { id: 'balasana', name: 'Child\'s Pose', sanskrit: 'BƒÅlƒÅsana', category: 'forward-folds', difficulty: 'easy', icon: 'üë∂',
              keypoints: ['knees_wide', 'hips_heels', 'arms_forward', 'forehead_down'],
              instructions: 'Knees wide, sit back on heels, arms extended forward.' },
            
            // Balancing
            { id: 'garudasana', name: 'Eagle Pose', sanskrit: 'Garu·∏çƒÅsana', category: 'balancing', difficulty: 'hard', icon: 'ü¶Ö',
              keypoints: ['legs_wrapped', 'arms_wrapped', 'sink_down', 'balance'],
              instructions: 'Wrap leg over leg, arms intertwined, sink into standing leg.' },
            { id: 'natarajasana', name: 'Dancer Pose', sanskrit: 'Na·π≠arƒÅjƒÅsana', category: 'balancing', difficulty: 'hard', icon: 'üíÉ',
              keypoints: ['standing_leg_straight', 'back_leg_lifted', 'hold_foot', 'chest_forward'],
              instructions: 'Balance on one leg, grab back foot, press up and forward.' },
            { id: 'ardha_chandrasana', name: 'Half Moon', sanskrit: 'Ardha CandrƒÅsana', category: 'balancing', difficulty: 'hard', icon: 'üåô',
              keypoints: ['standing_leg_straight', 'top_leg_lifted', 'arm_up', 'torso_open'],
              instructions: 'Balance on one leg and hand, stack hips and shoulders.' },
            
            // Inversions
            { id: 'adho_mukha', name: 'Downward Dog', sanskrit: 'Adho Mukha ≈övƒÅnƒÅsana', category: 'inversions', difficulty: 'easy', icon: 'üê∂',
              keypoints: ['hands_shoulder_width', 'hips_high', 'heels_down', 'spine_long'],
              instructions: 'Inverted V-shape, press hips up and back, heels toward floor.' },
            { id: 'sirsasana', name: 'Headstand', sanskrit: '≈öƒ´r·π£ƒÅsana', category: 'inversions', difficulty: 'hard', icon: 'üôÉ',
              keypoints: ['crown_on_floor', 'forearms_support', 'core_engaged', 'legs_vertical'],
              instructions: 'Balance on crown of head with forearm support, legs vertical.' },
            { id: 'sarvangasana', name: 'Shoulder Stand', sanskrit: 'SarvƒÅ·πÖgƒÅsana', category: 'inversions', difficulty: 'hard', icon: 'üïØÔ∏è',
              keypoints: ['shoulders_support', 'hands_back', 'legs_vertical', 'chin_chest'],
              instructions: 'Support on shoulders, hands on back, legs vertical.' },
            { id: 'halasana', name: 'Plow Pose', sanskrit: 'HalƒÅsana', category: 'inversions', difficulty: 'medium', icon: 'üöú',
              keypoints: ['shoulders_grounded', 'legs_overhead', 'toes_floor', 'spine_vertical'],
              instructions: 'From shoulder stand, lower legs overhead to touch floor.' },
            
            // Twists
            { id: 'ardha_matsyendrasana', name: 'Half Lord of Fishes', sanskrit: 'Ardha MatsyendrƒÅsana', category: 'seated', difficulty: 'medium', icon: 'üêü',
              keypoints: ['seated_twist', 'spine_tall', 'look_back', 'opposite_elbow_knee'],
              instructions: 'Seated twist with one leg bent, spine rotating.' },
            { id: 'parivrtta_trikonasana', name: 'Revolved Triangle', sanskrit: 'Pariv·πõtta Triko·πáƒÅsana', category: 'standing', difficulty: 'hard', icon: 'üîÑ',
              keypoints: ['legs_straight', 'twist_deep', 'arm_up', 'gaze_up'],
              instructions: 'Triangle position with torso twisted, reaching opposite hand to floor.' },
            
            // Core
            { id: 'navasana', name: 'Boat Pose', sanskrit: 'NƒÅvƒÅsana', category: 'seated', difficulty: 'medium', icon: '‚õµ',
              keypoints: ['balance_sit_bones', 'legs_lifted', 'arms_parallel', 'spine_long'],
              instructions: 'Balance on sit bones, legs and torso forming V-shape.' },
            { id: 'chaturanga', name: 'Four-Limbed Staff', sanskrit: 'Catura·πÖga Da·πá·∏çƒÅsana', category: 'inversions', difficulty: 'hard', icon: 'üí™',
              keypoints: ['plank_lowered', 'elbows_90', 'body_straight', 'core_engaged'],
              instructions: 'Low plank with elbows at 90 degrees, body in one line.' },
            
            // Restorative
            { id: 'savasana', name: 'Corpse Pose', sanskrit: '≈öavƒÅsana', category: 'seated', difficulty: 'easy', icon: 'üò¥',
              keypoints: ['lying_flat', 'arms_sides', 'palms_up', 'completely_relaxed'],
              instructions: 'Lie flat on back, arms by sides, complete relaxation.' },
            { id: 'viparita_karani', name: 'Legs Up Wall', sanskrit: 'Viparƒ´ta Kara·πáƒ´', category: 'inversions', difficulty: 'easy', icon: 'ü¶∂',
              keypoints: ['hips_wall', 'legs_vertical', 'arms_relaxed', 'spine_flat'],
              instructions: 'Lie with hips against wall, legs extended up wall.' },
        ];
        
        // Application State
        const state = {
            detector: null,
            video: null,
            canvas: null,
            ctx: null,
            isDetecting: false,
            selectedAsana: null,
            currentScore: 0,
            sessionStartTime: null,
            posesCompleted: 0,
            totalScore: 0,
            voiceEnabled: false,
            isRecording: false
        };
        
        // Skeleton connections for drawing
        const POSE_CONNECTIONS = [
            ['left_ear', 'left_eye'],
            ['left_eye', 'nose'],
            ['nose', 'right_eye'],
            ['right_eye', 'right_ear'],
            ['left_shoulder', 'right_shoulder'],
            ['left_shoulder', 'left_elbow'],
            ['left_elbow', 'left_wrist'],
            ['right_shoulder', 'right_elbow'],
            ['right_elbow', 'right_wrist'],
            ['left_shoulder', 'left_hip'],
            ['right_shoulder', 'right_hip'],
            ['left_hip', 'right_hip'],
            ['left_hip', 'left_knee'],
            ['left_knee', 'left_ankle'],
            ['right_hip', 'right_knee'],
            ['right_knee', 'right_ankle']
        ];
        
        // ================================================
        // INITIALIZATION
        // ================================================
        
        document.addEventListener('DOMContentLoaded', async () => {
            initializeUI();
            await initializePoseDetector();
            hideLoading();
        });
        
        function initializeUI() {
            // Populate asana selector
            const asanaGrid = document.getElementById('asanaGrid');
            const quickAsanas = asanaDatabase.slice(0, 8); // Show first 8 in quick selector
            
            asanaGrid.innerHTML = quickAsanas.map(asana => `
                <div class="asana-item" data-id="${asana.id}" onclick="selectAsana('${asana.id}')">
                    <span class="difficulty ${asana.difficulty}"></span>
                    <div class="icon">${asana.icon}</div>
                    <div class="name">${asana.name}</div>
                    <div class="sanskrit">${asana.sanskrit}</div>
                </div>
            `).join('');
            
            // Populate library grid
            const libraryGrid = document.getElementById('libraryGrid');
            libraryGrid.innerHTML = asanaDatabase.map(asana => `
                <div class="library-card" data-category="${asana.category}" onclick="selectAndPractice('${asana.id}')">
                    <div class="library-card-image">${asana.icon}</div>
                    <div class="library-card-content">
                        <h3>${asana.name}</h3>
                        <div class="sanskrit">${asana.sanskrit}</div>
                        <div class="library-card-meta">
                            <span class="meta-tag ${asana.difficulty}">${asana.difficulty}</span>
                            <span class="meta-tag">${asana.category}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    filterLibrary(btn.dataset.filter);
                });
            });
            
            // Set video and canvas references
            state.video = document.getElementById('videoElement');
            state.canvas = document.getElementById('canvasOverlay');
            state.ctx = state.canvas.getContext('2d');
        }
        
        async function initializePoseDetector() {
            try {
                // Initialize TensorFlow.js with fallback backends
                document.querySelector('.loading-text').textContent = 'Initializing AI Engine...';
                
                // Try to set backend with fallback chain: webgl -> cpu
                try {
                    await tf.setBackend('webgl');
                    await tf.ready();
                    console.log('Using WebGL backend');
                } catch (webglError) {
                    console.warn('WebGL failed, falling back to CPU:', webglError);
                    await tf.setBackend('cpu');
                    await tf.ready();
                    console.log('Using CPU backend (slower)');
                }
                
                document.querySelector('.loading-text').textContent = 'Loading Pose Detection Model...';
                
                // Load MoveNet model
                const model = poseDetection.SupportedModels.MoveNet;
                const detectorConfig = {
                    modelType: poseDetection.movenet.modelType.SINGLEPOSE_LIGHTNING,
                    enableSmoothing: true
                };
                state.detector = await poseDetection.createDetector(model, detectorConfig);
                console.log('Pose detector initialized successfully');
                
            } catch (error) {
                console.error('Error initializing pose detector:', error);
                // Fallback message
                document.querySelector('.loading-text').textContent = 'Error loading AI model. Please refresh or try a different browser.';
            }
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }
        
        // ================================================
        // CAMERA FUNCTIONS
        // ================================================
        
        async function enableCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        facingMode: 'user'
                    }
                });
                
                state.video.srcObject = stream;
                await state.video.play();
                
                // Set canvas size
                state.canvas.width = state.video.videoWidth;
                state.canvas.height = state.video.videoHeight;
                
                // Hide placeholder, show controls
                document.getElementById('cameraPlaceholder').classList.add('hidden');
                document.getElementById('cameraControls').style.display = 'flex';
                document.getElementById('liveStats').style.display = 'flex';
                document.getElementById('scoreDisplay').style.display = 'block';
                
                // Start session timer
                state.sessionStartTime = Date.now();
                updateSessionTimer();
                
                // Start pose detection
                state.isDetecting = true;
                detectPose();
                
            } catch (error) {
                console.error('Error accessing camera:', error);
                alert('Unable to access camera. Please check permissions.');
            }
        }
        
        function toggleCamera() {
            if (state.video.srcObject) {
                state.video.srcObject.getTracks().forEach(track => track.stop());
                state.video.srcObject = null;
                state.isDetecting = false;
                document.getElementById('cameraPlaceholder').classList.remove('hidden');
                document.getElementById('cameraControls').style.display = 'none';
                document.getElementById('liveStats').style.display = 'none';
                document.getElementById('scoreDisplay').style.display = 'none';
            } else {
                enableCamera();
            }
        }
        
        // ================================================
        // POSE DETECTION
        // ================================================
        
        async function detectPose() {
            if (!state.isDetecting || !state.detector) return;
            
            try {
                const poses = await state.detector.estimatePoses(state.video);
                
                // Clear canvas
                state.ctx.clearRect(0, 0, state.canvas.width, state.canvas.height);
                
                if (poses.length > 0) {
                    const pose = poses[0];
                    drawSkeleton(pose);
                    
                    if (state.selectedAsana) {
                        analyzeAlignment(pose);
                    }
                    
                    document.getElementById('poseStatus').textContent = 'Pose Detected';
                } else {
                    document.getElementById('poseStatus').textContent = 'No pose detected';
                }
                
            } catch (error) {
                console.error('Detection error:', error);
            }
            
            requestAnimationFrame(detectPose);
        }
        
        function drawSkeleton(pose) {
            const keypoints = pose.keypoints;
            const keypointMap = {};
            
            // Create keypoint map
            keypoints.forEach(kp => {
                keypointMap[kp.name] = kp;
            });
            
            // Draw connections
            state.ctx.strokeStyle = '#0071e3';
            state.ctx.lineWidth = 3;
            
            POSE_CONNECTIONS.forEach(([start, end]) => {
                const kp1 = keypointMap[start];
                const kp2 = keypointMap[end];
                
                if (kp1 && kp2 && kp1.score > 0.3 && kp2.score > 0.3) {
                    state.ctx.beginPath();
                    state.ctx.moveTo(kp1.x, kp1.y);
                    state.ctx.lineTo(kp2.x, kp2.y);
                    state.ctx.stroke();
                }
            });
            
            // Draw keypoints
            keypoints.forEach(kp => {
                if (kp.score > 0.3) {
                    state.ctx.beginPath();
                    state.ctx.arc(kp.x, kp.y, 6, 0, 2 * Math.PI);
                    state.ctx.fillStyle = getKeypointColor(kp.score);
                    state.ctx.fill();
                    state.ctx.strokeStyle = '#ffffff';
                    state.ctx.lineWidth = 2;
                    state.ctx.stroke();
                }
            });
        }
        
        function getKeypointColor(score) {
            if (score > 0.7) return '#34c759'; // Green
            if (score > 0.5) return '#ff9500'; // Orange
            return '#ff3b30'; // Red
        }
        
        // ================================================
        // ALIGNMENT ANALYSIS
        // ================================================
        
        function analyzeAlignment(pose) {
            const asana = asanaDatabase.find(a => a.id === state.selectedAsana);
            if (!asana) return;
            
            const keypoints = pose.keypoints;
            const keypointMap = {};
            keypoints.forEach(kp => { keypointMap[kp.name] = kp; });
            
            // Calculate angles and analyze alignment
            const feedback = [];
            let totalScore = 0;
            let checks = 0;
            
            // Spine alignment check
            const spineAngle = calculateSpineAngle(keypointMap);
            if (spineAngle !== null) {
                checks++;
                if (Math.abs(spineAngle - 180) < 15) {
                    feedback.push({ part: 'Spine', status: 'correct', message: 'Good alignment', angle: Math.round(spineAngle) + '¬∞' });
                    totalScore += 100;
                } else if (Math.abs(spineAngle - 180) < 30) {
                    feedback.push({ part: 'Spine', status: 'warning', message: 'Slightly curved', angle: Math.round(spineAngle) + '¬∞' });
                    totalScore += 70;
                } else {
                    feedback.push({ part: 'Spine', status: 'error', message: 'Straighten your back', angle: Math.round(spineAngle) + '¬∞' });
                    totalScore += 30;
                }
            }
            
            // Shoulder alignment
            const shoulderLevel = calculateShoulderLevel(keypointMap);
            if (shoulderLevel !== null) {
                checks++;
                if (Math.abs(shoulderLevel) < 5) {
                    feedback.push({ part: 'Shoulders', status: 'correct', message: 'Level and balanced', angle: Math.round(shoulderLevel) + '¬∞' });
                    totalScore += 100;
                } else if (Math.abs(shoulderLevel) < 15) {
                    feedback.push({ part: 'Shoulders', status: 'warning', message: 'Slightly uneven', angle: Math.round(shoulderLevel) + '¬∞' });
                    totalScore += 70;
                } else {
                    feedback.push({ part: 'Shoulders', status: 'error', message: 'Level your shoulders', angle: Math.round(shoulderLevel) + '¬∞' });
                    totalScore += 30;
                }
            }
            
            // Knee angles (for standing/balancing poses)
            if (['standing', 'balancing'].includes(asana.category)) {
                const leftKneeAngle = calculateAngle(
                    keypointMap['left_hip'],
                    keypointMap['left_knee'],
                    keypointMap['left_ankle']
                );
                
                if (leftKneeAngle !== null) {
                    checks++;
                    if (leftKneeAngle > 160) {
                        feedback.push({ part: 'Left Knee', status: 'correct', message: 'Properly extended', angle: Math.round(leftKneeAngle) + '¬∞' });
                        totalScore += 100;
                    } else if (leftKneeAngle > 140) {
                        feedback.push({ part: 'Left Knee', status: 'warning', message: 'Extend more', angle: Math.round(leftKneeAngle) + '¬∞' });
                        totalScore += 70;
                    } else {
                        feedback.push({ part: 'Left Knee', status: 'error', message: 'Knee too bent', angle: Math.round(leftKneeAngle) + '¬∞' });
                        totalScore += 30;
                    }
                }
            }
            
            // Hip alignment
            const hipLevel = calculateHipLevel(keypointMap);
            if (hipLevel !== null) {
                checks++;
                if (Math.abs(hipLevel) < 5) {
                    feedback.push({ part: 'Hips', status: 'correct', message: 'Level and aligned', angle: Math.round(hipLevel) + '¬∞' });
                    totalScore += 100;
                } else if (Math.abs(hipLevel) < 15) {
                    feedback.push({ part: 'Hips', status: 'warning', message: 'Slightly tilted', angle: Math.round(hipLevel) + '¬∞' });
                    totalScore += 70;
                } else {
                    feedback.push({ part: 'Hips', status: 'error', message: 'Level your hips', angle: Math.round(hipLevel) + '¬∞' });
                    totalScore += 30;
                }
            }
            
            // Calculate final score
            const score = checks > 0 ? Math.round(totalScore / checks) : 0;
            updateScore(score);
            updateAlignmentFeedback(feedback);
            
            // Voice feedback
            if (state.voiceEnabled && feedback.some(f => f.status === 'error')) {
                speakFeedback(feedback.filter(f => f.status === 'error')[0].message);
            }
        }
        
        function calculateAngle(p1, p2, p3) {
            if (!p1 || !p2 || !p3 || p1.score < 0.3 || p2.score < 0.3 || p3.score < 0.3) return null;
            
            const radians = Math.atan2(p3.y - p2.y, p3.x - p2.x) - Math.atan2(p1.y - p2.y, p1.x - p2.x);
            let angle = Math.abs(radians * 180 / Math.PI);
            if (angle > 180) angle = 360 - angle;
            return angle;
        }
        
        function calculateSpineAngle(keypoints) {
            const nose = keypoints['nose'];
            const leftHip = keypoints['left_hip'];
            const rightHip = keypoints['right_hip'];
            
            if (!nose || !leftHip || !rightHip) return null;
            if (nose.score < 0.3 || leftHip.score < 0.3 || rightHip.score < 0.3) return null;
            
            const hipCenter = { x: (leftHip.x + rightHip.x) / 2, y: (leftHip.y + rightHip.y) / 2 };
            const angle = Math.atan2(nose.y - hipCenter.y, nose.x - hipCenter.x) * 180 / Math.PI;
            return Math.abs(angle + 90); // Normalize to 180 for vertical
        }
        
        function calculateShoulderLevel(keypoints) {
            const left = keypoints['left_shoulder'];
            const right = keypoints['right_shoulder'];
            
            if (!left || !right || left.score < 0.3 || right.score < 0.3) return null;
            
            return Math.atan2(right.y - left.y, right.x - left.x) * 180 / Math.PI;
        }
        
        function calculateHipLevel(keypoints) {
            const left = keypoints['left_hip'];
            const right = keypoints['right_hip'];
            
            if (!left || !right || left.score < 0.3 || right.score < 0.3) return null;
            
            return Math.atan2(right.y - left.y, right.x - left.x) * 180 / Math.PI;
        }
        
        // ================================================
        // UI UPDATES
        // ================================================
        
        function updateScore(score) {
            state.currentScore = score;
            
            // Update score display
            document.getElementById('scoreNumber').textContent = score;
            
            // Update progress ring
            const circumference = 2 * Math.PI * 45;
            const offset = circumference - (score / 100) * circumference;
            const progress = document.getElementById('scoreProgress');
            progress.style.strokeDashoffset = offset;
            
            // Update color based on score
            if (score >= 80) {
                progress.style.stroke = '#34c759';
            } else if (score >= 50) {
                progress.style.stroke = '#ff9500';
            } else {
                progress.style.stroke = '#ff3b30';
            }
        }
        
        function updateAlignmentFeedback(feedback) {
            const list = document.getElementById('alignmentList');
            
            if (feedback.length === 0) {
                list.innerHTML = `
                    <div class="alignment-item">
                        <div class="alignment-icon">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="8" x2="12" y2="16"/>
                                <line x1="8" y1="12" x2="16" y2="12"/>
                            </svg>
                        </div>
                        <div class="alignment-info">
                            <div class="part">Analyzing...</div>
                            <div class="feedback">Hold your pose steady</div>
                        </div>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = feedback.map(f => `
                <div class="alignment-item ${f.status}">
                    <div class="alignment-icon">
                        ${f.status === 'correct' ? 
                            '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>' :
                          f.status === 'warning' ?
                            '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>' :
                            '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>'
                        }
                    </div>
                    <div class="alignment-info">
                        <div class="part">${f.part}</div>
                        <div class="feedback">${f.message}</div>
                    </div>
                    <div class="alignment-angle">${f.angle}</div>
                </div>
            `).join('');
        }
        
        function updateSessionTimer() {
            if (!state.sessionStartTime) return;
            
            const elapsed = Math.floor((Date.now() - state.sessionStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
            const seconds = (elapsed % 60).toString().padStart(2, '0');
            document.getElementById('sessionTime').textContent = `${minutes}:${seconds}`;
            
            // Update calories (rough estimate)
            document.getElementById('calories').textContent = Math.floor(elapsed * 0.05);
            
            setTimeout(updateSessionTimer, 1000);
        }
        
        // ================================================
        // ASANA SELECTION
        // ================================================
        
        function selectAsana(id) {
            state.selectedAsana = id;
            const asana = asanaDatabase.find(a => a.id === id);
            
            // Update UI
            document.querySelectorAll('.asana-item').forEach(item => {
                item.classList.toggle('selected', item.dataset.id === id);
            });
            
            document.getElementById('currentAsana').textContent = asana.name;
            
            // Voice announcement
            if (state.voiceEnabled) {
                speakFeedback(`Now practicing ${asana.name}. ${asana.instructions}`);
            }
        }
        
        function selectAndPractice(id) {
            selectAsana(id);
            document.getElementById('practice').scrollIntoView({ behavior: 'smooth' });
            
            // If camera not enabled, prompt
            if (!state.video.srcObject) {
                setTimeout(() => enableCamera(), 500);
            }
        }
        
        function filterLibrary(category) {
            document.querySelectorAll('.library-card').forEach(card => {
                if (category === 'all' || card.dataset.category === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // ================================================
        // VOICE GUIDANCE
        // ================================================
        
        function toggleVoice() {
            state.voiceEnabled = !state.voiceEnabled;
            document.getElementById('voiceToggle').classList.toggle('active', state.voiceEnabled);
            
            if (state.voiceEnabled) {
                speakFeedback('Voice guidance enabled');
            }
        }
        
        let lastSpokenTime = 0;
        function speakFeedback(text) {
            // Throttle to prevent spam
            if (Date.now() - lastSpokenTime < 3000) return;
            lastSpokenTime = Date.now();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.9;
            utterance.pitch = 1;
            speechSynthesis.speak(utterance);
        }
        
        // ================================================
        // ADDITIONAL CONTROLS
        // ================================================
        
        function startPractice() {
            document.getElementById('practice').scrollIntoView({ behavior: 'smooth' });
            setTimeout(() => enableCamera(), 500);
        }
        
        function toggleRecording() {
            state.isRecording = !state.isRecording;
            document.getElementById('recordBtn').classList.toggle('record', state.isRecording);
            
            if (state.isRecording) {
                alert('Recording started. This feature saves your session for later review.');
            } else {
                alert('Recording stopped.');
            }
        }
        
        function captureSnapshot() {
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = state.video.videoWidth;
            tempCanvas.height = state.video.videoHeight;
            const tempCtx = tempCanvas.getContext('2d');
            
            // Draw mirrored video
            tempCtx.translate(tempCanvas.width, 0);
            tempCtx.scale(-1, 1);
            tempCtx.drawImage(state.video, 0, 0);
            
            // Draw skeleton overlay
            tempCtx.setTransform(1, 0, 0, 1, 0, 0);
            tempCtx.translate(tempCanvas.width, 0);
            tempCtx.scale(-1, 1);
            tempCtx.drawImage(state.canvas, 0, 0);
            
            // Download
            const link = document.createElement('a');
            link.download = `asana-${state.selectedAsana || 'pose'}-${Date.now()}.png`;
            link.href = tempCanvas.toDataURL('image/png');
            link.click();
        }
        
        function toggleFullscreen() {
            const section = document.querySelector('.camera-section');
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                section.requestFullscreen();
            }
        }
    </script>
</body>
</html>
